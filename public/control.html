<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <title>Controller</title>
    <style>
        body { font-family: sans-serif; background: #222; color: white; text-align: center; padding: 20px; }
        .btn-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px; }
        button { padding: 20px; font-size: 18px; border: none; border-radius: 12px; cursor: pointer; color: white; font-weight: bold;}
        .loc-btn { background: #2196F3; }
        .alert-btn { background: #f44336; grid-column: span 2; }
        input { width: 100%; padding: 15px; border-radius: 8px; border: none; margin-bottom: 15px; box-sizing: border-box;}
        #status { margin-top: 10px; color: #aaa; }
    </style>
</head>
<body>
    <h2>Update Kiosk</h2>
    
    <input type="text" id="customMsg" placeholder="Custom message...">
    <button onclick="sendUpdate(document.getElementById('customMsg').value)" style="width:100%; background:#555; margin-bottom:20px;">Send Custom Text</button>

    <div class="btn-grid">
        <button class="loc-btn" onclick="sendUpdate('ğŸ  At Home')">ğŸ  Home</button>
        <button class="loc-btn" onclick="sendUpdate('ğŸ“ At College')">ğŸ“ College</button>
        <button class="loc-btn" onclick="sendUpdate('ğŸ” Getting Food')">ğŸ” Food</button>
        <button class="loc-btn" onclick="sendUpdate('ğŸš— Driving')">ğŸš— Driving</button>
        <button class="alert-btn" onclick="sendAlert()">ğŸš¨ SEND ALERT ğŸš¨</button>
    </div>

    <p id="status">Ready</p>

    <script>
        // Send data to server
        async function sendData(payload) {
            document.getElementById('status').innerText = "Sending...";
            try {
                // Get Location automatically
                if (navigator.geolocation) {
                     navigator.geolocation.getCurrentPosition(async (position) => {
                        payload.lat = position.coords.latitude;
                        payload.lon = position.coords.longitude;
                        await postToServer(payload);
                     }, async () => {
                        // If location fails, send without it
                        await postToServer(payload);
                     });
                } else {
                    await postToServer(payload);
                }
            } catch (e) {
                document.getElementById('status').innerText = "Error!";
            }
        }

        async function postToServer(payload) {
            await fetch('/update', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify(payload)
            });
            document.getElementById('status').innerText = "Sent: " + (payload.msg || "Alert");
        }

        function sendUpdate(msg) {
            sendData({ msg: msg, alert: false });
        }

        function sendAlert() {
            sendData({ msg: "HELP", alert: true });
        }
    </script>
</body>
</html>
